---
import DocLayout from "../../layouts/DocLayout.astro";
import { resolve, join } from "node:path";
import { readdirSync } from "node:fs";

const VTT_DIR_REL = import.meta.env.VTT_DIR ?? process.env.VTT_DIR ?? "../../../whisper-bench/data/output";
const VTT_DIR = resolve(process.cwd(), VTT_DIR_REL);

let files: string[] = [];
let error: string | null = null;

try {
  const fileNames = readdirSync(VTT_DIR);
  for (const name of fileNames) {
    if (name.endsWith(".vtt")) {
      files.push(name);
    }
  }
  files.sort();
} catch (e) {
  error = e instanceof Error ? e.message : String(e);
}
---

<DocLayout title="VTT Library">
  <h1>VTT Library</h1>
  
  <p>Reading from: <code>{VTT_DIR}</code></p>

  {error && (
    <div style="color: red; padding: 1rem; border: 1px solid red; margin-bottom: 1rem;">
      <strong>Error reading directory:</strong> {error}
    </div>
  )}

  <ul>
    {files.map((file) => (
      <li>
        <a href={`/vtt/${file}`}>{file}</a>
      </li>
    ))}
  </ul>
  
  {files.length === 0 && !error && <p>No VTT files found.</p>}
</DocLayout>
